<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Removing Friction</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="The ZeroMQ Guide - for C Developers" /><link rel="up" href="ch09.html" title="Chapter 9. Postface" /><link rel="prev" href="ch09s02.html" title="How This Book Happened" /><link rel="next" href="ch09s04.html" title="Licensing" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Removing Friction</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09s02.html">Prev</a> </td><th width="60%" align="center">Chapter 9. Postface</th><td width="20%" align="right"> <a accesskey="n" href="ch09s04.html">Next</a></td></tr></table><hr /></div><div class="sect1" title="Removing Friction"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp21518240"></a>Removing Friction</h2></div></div></div><p>I'll explain the technical tool chain we used in terms of the friction we removed. In this book we're telling a story and the goal is to reach as many people as possible, as cheaply and smoothly as we can.</p><p>The core idea was to host the text and examples on GitHub and make it easy for anyone to contribute. It turned out to be more complex than that, however.</p><p>Let's start with the division of labor. I'm a good writer and can produce endless amounts of decent text quickly. But what was impossible for me was to provide the examples in other languages. Because the core ØMQ API is in C, it seemed logical to write the original examples in C. Also, C is a neutral choice; it's perhaps the only language that doesn't create strong emotions.</p><p>How to encourage people to make translations of the examples? We tried a few approaches and finally what worked best was to offer a "choose your language" link on every single example in the text, which took people either to the translation or to a page explaining how they could contribute. The way it usually works is that as people learn ØMQ in their preferred language, they contribute a handful of translations or fixes to the existing ones.</p><p>At the same time, I noticed a few people quite determinedly translating <span class="emphasis"><em>every single</em></span> example. This was mainly binding authors who realized that the examples were a great way to encourage people to use their bindings. For their efforts, I extended the scripts to produce language-specific versions of the book. Instead of including the C code, we'd include the Python, or PHP code. Lua and Haxe also got their dedicated versions.</p><p>Once we have an idea of who works on what, we know how to structure the work itself. It's clear that to write and test an example, what you want to work on is <span class="emphasis"><em>source code</em></span>. So we import this source code when we build the book, and that's how we make language-specific versions.</p><p>I like to write in a plain text format. It's fast and works well with source control systems like git. Because the main platform for our websites is Wikidot, I write using Wikidot's very readable markup format.</p><p>At least in the first chapters, it was important to draw pictures to explain the flow of messages between peers. Making diagrams by hand is a lot of work, and when we want to get final output in different formats, image conversion becomes a chore. I started with Ditaa, which turns text diagrams into PNGs, then later switched to asciitosvg, which produces SVG files, which are rather better. Since the figures are text diagrams, embedded in the prose, it's remarkably easy to work with them.</p><p>By now you'll realize that the toolchain we use is highly customized, though it uses a lot of external tools. All are available on Ubuntu, which is a mercy, and the whole custom toolchain is in the zguide repository in the bin subdirectory.</p><p>Let's walk through the editing and publishing process. Here is how we produce the online version:</p><pre class="screen">bin/buildguide
</pre><p>Which works as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The original text sits in a series of text files (one per chapter).</p></li><li class="listitem"><p>The examples sit in the examples subdirectory, classified per language.</p></li><li class="listitem"><p>We take the text and process this using a custom Perl script, mkwikidot, into a set of Wikidot-ready files.</p></li><li class="listitem"><p>We do this for each of the languages that get their own version.</p></li><li class="listitem"><p>We extract the graphics and call asciitosvg and rasterize on each one to produce image files, which we store in the images subdirectory.</p></li><li class="listitem"><p>We extract inline listings (which are not translated) and stores these in the listings subdirectory.</p></li><li class="listitem"><p>We use pygmentize on each example and listing to create a marked-up page in Wikidot format.</p></li><li class="listitem"><p>We upload all changed files to the online wiki using the Wikidot API.</p></li></ul></div><p>Doing this from scratch takes a while. So we store the SHA1 signatures of every image, listing, example, and text file, and only process and upload changes, and that makes it easy to publish a new version of the text when people make new contributions.</p><p>To produce the PDF and Epub formats, we do the following:</p><pre class="screen">bin/buildpdfs
</pre><p>Which works as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>We use the custom mkdocbook Perl program on the input files to produce a DocBook output.</p></li><li class="listitem"><p>We push the DocBook format through docbook2ps and ps2pdf to create clean PDFs in each language.</p></li><li class="listitem"><p>We push the DocBook format though db2epub to create Epub books and in each language.</p></li><li class="listitem"><p>We upload the PDFs to the public wiki using the Wikidot API.</p></li></ul></div><p>When creating a community project, it's important to lower the "change latency", which is the time it takes for people to see their work live or, at least, to see that you've accepted their pull request. If that is more than a day or two, you've often lost your contributor's interest.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09s02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch09.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">How This Book Happened </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Licensing</td></tr></table></div></body></html>
