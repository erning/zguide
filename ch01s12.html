<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Upgrading from ØMQ v2.2 to ØMQ v3.2</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="The ZeroMQ Guide - for C Developers" /><link rel="up" href="ch01.html" title="Chapter 1. ØMQ基础" /><link rel="prev" href="ch01s11.html" title="套接字的扩展性" /><link rel="next" href="ch01s13.html" title="Warning: Unstable Paradigms!" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Upgrading from ØMQ v2.2 to ØMQ v3.2</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s11.html">Prev</a> </td><th width="60%" align="center">Chapter 1. ØMQ基础</th><td width="20%" align="right"> <a accesskey="n" href="ch01s13.html">Next</a></td></tr></table><hr /></div><div class="sect1" title="Upgrading from ØMQ v2.2 to ØMQ v3.2"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp19064112"></a>Upgrading from ØMQ v2.2 to ØMQ v3.2</h2></div></div></div><div class="sect2" title="Compatible Changes"><div class="titlepage"><div><div><h3 class="title"><a id="idp19065048"></a>Compatible Changes</h3></div></div></div><p>These changes don't impact existing application code directly:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Pub-sub filtering is now done at the publisher side instead of subscriber side. This improves performance significantly in many pub-sub use cases. You can mix v3.2 and v2.1/v2.2 publishers and subscribers safely.</p></li><li class="listitem"><p>ØMQ v3.2 has many new API methods (<code class="literal">zmq_disconnect()</code>, <code class="literal">zmq_unbind()</code>, <code class="literal">zmq_monitor()</code>, <code class="literal">zmq_ctx_set()</code>, etc.)</p></li></ul></div></div><div class="sect2" title="Incompatible Changes"><div class="titlepage"><div><div><h3 class="title"><a id="idp19067920"></a>Incompatible Changes</h3></div></div></div><p>These are the main areas of impact on applications and language bindings:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Changed send/recv methods: <code class="literal">zmq_send()</code> and <code class="literal">zmq_recv()</code> have a different, simpler interface, and the old functionality is now provided by <code class="literal">zmq_msg_send()</code> and <code class="literal">zmq_msg_recv()</code>. Symptom: compile errors. Solution: fix up your code.</p></li><li class="listitem"><p>These two methods return positive values on success, and -1 on error. In v2.x they always returned zero on success. Symptom: apparent errors when things actually work fine. Solution: test strictly for return code = -1, not non-zero.</p></li><li class="listitem"><p><code class="literal">zmq_poll()</code> now waits for milliseconds, not microseconds. Symptom: application stops responding (in fact responds 1000 times slower). Solution: use the <code class="literal">ZMQ_POLL_MSEC</code> macro defined below, in all <code class="literal">zmq_poll</code> calls.</p></li><li class="listitem"><p><code class="literal">ZMQ_NOBLOCK</code> is now called <code class="literal">ZMQ_DONTWAIT</code>. Symptom: compile failures on the <code class="literal">ZMQ_NOBLOCK</code> macro.</p></li><li class="listitem"><p>The <code class="literal">ZMQ_HWM</code> socket option is now broken into <code class="literal">ZMQ_SNDHWM</code> and <code class="literal">ZMQ_RCVHWM</code>.  Symptom: compile failures on the <code class="literal">ZMQ_HWM</code> macro.</p></li><li class="listitem"><p>Most but not all <code class="literal">zmq_getsockopt()</code> options are now integer values. Symptom: runtime error returns on <code class="literal">zmq_setsockopt</code> and <code class="literal">zmq_getsockopt</code>.</p></li><li class="listitem"><p>The <code class="literal">ZMQ_SWAP</code> option has been removed. Symptom: compile failures on <code class="literal">ZMQ_SWAP</code>. Solution: redesign any code that uses this functionality.</p></li></ul></div></div><div class="sect2" title="Suggested Shim Macros"><div class="titlepage"><div><div><h3 class="title"><a id="idp19077192"></a>Suggested Shim Macros</h3></div></div></div><p>For applications that want to run on both v2.x and v3.2, such as language bindings, our advice is to emulate c3.2 as far as possible. Here are C macro definitions that help your C/C++ code to work across both versions (taken from <a class="ulink" href="http://czmq.zeromq.org" target="_top">CZMQ</a>):</p><pre class="programlisting">
#ifndef ZMQ_DONTWAIT
#   define ZMQ_DONTWAIT     ZMQ_NOBLOCK
#endif
#if ZMQ_VERSION_MAJOR == 2
#   define zmq_msg_send(msg,sock,opt) zmq_send (sock, msg, opt)
#   define zmq_msg_recv(msg,sock,opt) zmq_recv (sock, msg, opt)
#   define zmq_ctx_destroy(context) zmq_term(context)
#   define ZMQ_POLL_MSEC    1000        //  zmq_poll is usec
#   define ZMQ_SNDHWM ZMQ_HWM
#   define ZMQ_RCVHWM ZMQ_HWM
#elif ZMQ_VERSION_MAJOR == 3
#   define ZMQ_POLL_MSEC    1           //  zmq_poll is msec
#endif
</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s11.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch01s13.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">套接字的扩展性 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Warning: Unstable Paradigms!</td></tr></table></div></body></html>
